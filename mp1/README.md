## Compilation
CMake 2.8.12.2 is used to generate Makefiles (sudo yum install cmake).  
Initially, if there are no Makefiles, then the user must execute `cmake .`
in the mp1 directory with the CMakeLists.txt file.

The current configuration will generate Makefiles for all of the applications.  
Then the executables will be generated by running `make` from mp1/ to compile all applications or each individual application if used in their respective directories.

Since Boost.Asio is used, it is important to have that installed before attempting to compile the programs (sudo yum install boost-devel).

## Execution
#### **Server**
The server is executed by calling `./log_grep_server` from the mp1/server directory.  
It should be noted that the server can also run in the background by executing it as `./log_grep_server &`  
The servers are configured to listen on port 1867. Due to their size, the vm*.log files will not be provided in this repository and must be obtained manually.
**NOTE:** All files that are grepped must be specified relative to the executable path. (i.e. it will grep server/vm4.log if vm4.log is used as an argument)

#### **Client**
The client is executed by calling `./log_grep [-flags] [pattern] [filename(s)]`  
There are several things to take into consideration:
- Flags are supported with this implementation along with regex for the most part (refer to point below)
- Beware of escape characters and quotations in the pattern regex; they must be handled properly by the user
- `./log_grep GET vm*.log` will grep the GET pattern from all the log files beginning with vm and ending with .log  

The client will attempt to connect and execute the command on all 10 VMs on port 1867. 

## Output
After running the client at least once, there will be files titled log_query#.txt where # is the log number.
There will also be console output describing how many lines were retrieved from each machine, and the total from all machines.
The console output will look something like this:  
```
[aeshen2@fa17-cs425-g48-01 client]$ ./log_grep "\"\\.*\"" vm*.log
vm1: 343780
vm2: 347232
vm3: 349943
vm4: 347621
vm5: 349385
vm6: 351980
vm7: 354314
vm8: 353348
vm9: 351845
vm10: 312173
Total: 3461621
```
Notice that the pattern is actually interpreted as: `grep "\.*" vm*.log` and the number of matching lines is listed next to the VM, followed by the sum.
Inactive/failed VMs will output 0.

## Benchmarking
The benchmark contains files used to calculate the average query latency.  
`./benchmark_grep` will output the time it takes to run grep NASA benchmark*.log
which looks through the 60MB files in VMs 2-5. Again, these will not be provided because it takes a long time to pull them.  
VMs2-5 must be running the server application to accurately benchmark the query latency.

## Testing
The test directory contains the file used to run unit tests.  
The tests rely on the pre-defined log files found in server/test_logs where each test case has a directory of relevant logs. 

`./test_NCSA.sh [pattern]` will run pattern on NCSA logs (vmi.log) and print out if the result is correct (both file and returned #lines) for each machine.<br />
Sample output:
```
[twu54@fa17-cs425-g48-01 test]$ ./test_NCSA.sh GET
checking error for machine 1 ....
checking error for machine 2 ....
checking error for machine 3 ....
checking error for machine 4 ....
checking error for machine 5 ....
checking error for machine 6 ....
checking error for machine 7 ....
checking error for machine 8 ....
checking error for machine 9 ....
checking error for machine 10 ....
DONE
```
Be sure to have vmi.log on server folder for each machine i and every vmi.log files (for i from 1 to 10) be in mp1/log_check folder in the current machine before running.<br />
Server i must be running for machine i to contain no errors in result. If there is a diff in files, it will return you a log_query file and an expected result file to check.
<br />

`./log_grep_test` will run all unit tests and output 'PASS' or 'FAIL' for each test case.  
Sample output:
```
[aeshen2@fa17-cs425-g48-01 test]$ ./log_grep_test
TestEmptyFiles: PASS
TestOneMachineRarePattern: PASS
TestOneMachineSomewhatFrequentPattern: PASS
TestOneMachineFrequentPattern: PASS
TestSomeMachinesRarePattern: PASS
TestSomeMachinesSomewhatFrequentPattern: PASS
TestSomeMachinesFrequentPattern: PASS
TestAllMachinesRarePattern: PASS
TestAllMachinesSomwhatFrequentPattern: PASS
TestAllMachinesFrequentPattern: PASS
```
**NOTE:** All servers must be running (VMs 1-10) to provide accurate test results
## References
[Boost.Asio](http://www.boost.org/doc/libs/1_53_0/doc/html/boost_asio.html)
